<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html, charset=UTF-8">
<meta http-equiv="Cache-control" content="NO-STORE">
<meta name="viewport" content="width=device-width, initial-scale= 1.0, maximum-scale= 1.0, minimum-scale=1.0, user-scalable=no">
<script language="javascript" type="text/javascript">
var creative_type_id    = '{[creative_type_id]}';
var campaign_id         = '{[campaign_id]}';
var creative_id         = '{[creative_id]}';
var location_id         = '{[location_id]}';
var ad_type             = '{[ad_type]}';
var mraid_ad_id         = '{[mraid_ad_id]}';
var strStatsUrl         = "{[statsUrl]}";
var clickUrlRedirect    = "{[clickURLRedirect]}";
var os                  = "{[os]}";
var is_tablet           = "{[is_tablet]}";
var ptrackers           = '{[pixel_trackers]}';
var deviceSoundVolume   = '{[deviceSoundVolume]}';
var isViewabilityMoat   = '{[isViewabilityMoat]}';
var game_platform       = '{[game_platform]}';
var impressionMade = 0;
var clickMade = 0;
var clickLimit = 1;

var params = (function (url) {
    var regex = /[?&]([^=#]+)=([^&#]*)/g,
	params = {},
	match;
	while (match = regex.exec(url)) {
		params[match[1]] = decodeURIComponent(match[2]);
	}
	return params;
}(strStatsUrl));
</script>
<script type="text/javascript" src="{[connectionProtocol]}://{[domainName]}/un/web/callClientTrackingWithoutImpression.js?ver={[timestamp]}"></script>
<style type="text/css">
html, body {
	margin: 0;
	padding: 0;
	width: 100vw;
	height: 100vh;
}
html {	
	position: absolute;
	-webkit-transform: rotate(0);
	-webkit-transform-origin: 50% 28%;
	-ms-transform: rotate(0);
	-ms-transform-origin: 50% 28%;
	transform: rotate(0);
	transform-origin: 50% 28%;
	background: transparent;
}
head, script, style {
	display: none;
	opacity: 0;
}
body {
	display: block;
	background-color: rgba(0,0,0,.65);
	overflow: hidden;
}
#adFrame {
	position: absolute;
	width: 100vw;
	height: 100vh;
}
#img_holder {
	position: absolute;
	z-index: 1;
	top: 50% !important;
	left: 50% !important;
	-webkit-transform: translateX(-50%) translateY(-50%);
	-ms-transform: translateX(-50%) translateY(-50%);
	transform: translateX(-50%) translateY(-50%);
}
#image {
	display: block;
	max-height: 100vh;
	max-width: 100vw;
}
#exitArea {
	display: block;
	visibility: hidden;
	opacity: 0;
	position: absolute;
	top: 0;
	right: 0;
	padding: 10px;
	z-index: 9999;
}
#exitArea img {
	display: block;
	width: 5vw;
	height: 5vw;
}
@media screen and (orientation: portrait) {
	#exitArea img {
		display: block;
		width: 5vh;
		height: 5vh;
	}
}
#advertisement {
	display: none;
	opacity: 0;
	position: absolute;
	bottom: 0px;
	right: 0px;
	padding: 1px;
	z-index: 9999;
	font-family: sans-serif;
	font-size: 0.8em;
	color: #fff;
	text-shadow: 1px 1px 5px #000, -1px -1px 5px #000, 1px 1px 5px #000, -1px -1px 5px #000;
	z-index: 9999;
}
@media screen and (orientation: portrait) {
	#exitArea {
		opacity: 1;
	}
	#advertisement {
		display: block;
		position: absolute;
		bottom: 0px;
		right: 0px;
	}
}
#debug_area {
	display: none;
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 50%;
	background: rgba(255,255,255,.7);
	color: red;
	font-size: 14px;
	line-height: 16px;
	z-index: 9998;
}
#loader-wrapper {
	position: fixed;
	top: 0;
	left: 0;
	width: 100%;
	height: 100%;
}
#loader-wrapper.with-background {
	background: rgba(0,0,0,.5);
}
#loader {
	position: fixed;
	top: 50%;
	left: 50%;
	width: 100px;
	height: 100px;
	margin: -50px 0 0 -50px;
}
#loader:before {
	content: "";
	position: absolute;
	top: 50%;
	left: 50%;
	width: 50px;
	height: 50px;
	margin: -28px 0 0 -28px;
	border: 6px solid #fff;
	border-radius: 50%;
	opacity: 0.3;
	-webkit-animation: loaderScale 1.25s infinite linear;
	animation: loaderScale 1.25s infinite linear;
}
#loader:after {
	content: "";
	position: absolute;
	top: 50%;
	left: 50%;
	width: 54px;
	height: 54px;
	margin: -27px 0 0 -27px;
	border: 3px solid transparent;
	border-bottom: 3px solid #fff;
	border-radius: 50%;
	-webkit-transform: scale(1) rotate(0);
	transform: scale(1) rotate(0);
	-webkit-animation: loaderRotate 1.25s infinite linear;
	animation: loaderRotate 1.25s infinite linear;
}
@-webkit-keyframes loaderRotate {
	50% {
		-webkit-transform: scale(1.1) rotate(360deg);
		transform: scale(1.1) rotate(360deg);
	}
	100% {
		-webkit-transform: scale(1) rotate(720deg);
		transform: scale(1) rotate(720deg);
	}
}
@keyframes loaderRotate {
	50% {
		-webkit-transform: scale(1.1) rotate(360deg);
		transform: scale(1.1) rotate(360deg);
	}
	100% {
		-webkit-transform: scale(1) rotate(720deg);
		transform: scale(1) rotate(720deg);
	}
}
@-webkit-keyframes loaderScale {
	50% {
		opacity: 0.05;
		-webkit-transform: scale(1.1);
		transform: scale(1.1);
	}
	100% {
		-webkit-transform: scale(1);
		transform: scale(1);
	}
}
@keyframes loaderScale {
	50% {
		opacity: 0.05;
		-webkit-transform: scale(1.1);
		transform: scale(1.1);
	}
	100% {
		-webkit-transform: scale(1);
		transform: scale(1);
	}
}
</style>
</head>
<body>
<div id="ptrack" style="width: 0px; height: 0px; display: none; opacity: 0;" ></div>
<div id="debug_area"></div>
<div id="adFrame">
	<div id="img_holder">
		<span id="exitArea" onclick="closeAd()">
			<img id="closeImg" src="https://ingameads.gameloft.com/ads/adserver/web/fullscreen/images/newIcons/close_button.png">
		</span>
		<img id="image" onload="sendImpression()"></img>
		<div id="click_area" style="position: absolute;width: 100%;height: 75%;bottom: 0px; right: 0px;"></div>
		<div id="advertisement">{[advertisement]}</div>
	</div>
</div>
<div id="loader-wrapper">
	<div id="loader"></div>
</div>

<script>
var DEBUG_MODE = true;
var CTA_ld = 'https://bs.serving-sys.com/serving/adServer.bs?cn=trd&mc=click&pli=22076541&PluID=0&ord=%time%';
var CTA_pt = CTA_ld;

var images = {
	'portrait': {
		'android': { /* 1080x1920 */
			'src': 'https://igp06.gameloft.com/igp/ng_resources/creative-65244/cb/int_campbells-goldfish_android_portrait_v2.jpg',
			'href': CTA_pt
		},
		'default': { /* 1536x2048 */
			'src': 'https://igp06.gameloft.com/igp/ng_resources/creative-65244/8a/int_campbells-goldfish_ios_portrait_v2.jpg',
			'href': CTA_pt
		}
	},
	'landscape': {
		'android': { /* 1920x1080 */
			'src': 'https://igp06.gameloft.com/igp/ng_resources/creative-65244/6c/int_goldfish_android_1920x1080_v3.jpg',
			'href': CTA_ld
		},
		'default': { /* 2048x1536 */
			'src': 'https://igp06.gameloft.com/igp/ng_resources/creative-65244/49/int_goldfish_ios_2048x1536.jpg',
			'href': CTA_ld
		}
	}
};

function getViewportDimensions() {
	var viewportWidth;
	var viewportHeight;

	// the more standards compliant browsers (mozilla/netscape/opera/IE7) use window.innerWidth and window.innerHeight
	if (typeof window.innerWidth != 'undefined') {
		viewportWidth = window.innerWidth;
		viewportHeight = window.innerHeight;
	}
	// IE6 in standards compliant mode (i.e. with a valid doctype as the first line in the document)
	else if (typeof document.documentElement != 'undefined'
		&& typeof document.documentElement.clientWidth !=
		'undefined' && document.documentElement.clientWidth != 0) {
		viewportWidth = document.documentElement.clientWidth;
		viewportHeight = document.documentElement.clientHeight;
	}
	// older versions of IE
	else {
		viewportWidth = document.getElementsByTagName('body')[0].clientWidth;
		viewportHeight = document.getElementsByTagName('body')[0].clientHeight;
	}

	return {
		width: viewportWidth,
		height: viewportHeight
	};
}

function setPixelTracker(url) {
	var pixel = document.createElement('img');
	pixel.src = url;
	document.getElementById('ptrack').appendChild(pixel);
}

function redirect(url) {
	if (os.toLowerCase().indexOf('win', 'winp', 'windows') != -1) {
		window.external.notify(url);
	} else {
		document.location = url;
	}
}

var allowClick = true;
function clickThru(cta) {
	if (allowClick) {
		var url = 'link:' + clickUrlRedirect + encodeURIComponent(cta).replace(/%20/g,'+');
		if (!!clickLimit && clickMade >= clickLimit) {
			url = 'link:' + cta;
		}
		console.log(url);
		clickMade++;
		allowClick = false;
		setTimeout(function () {
			allowClick = true;
		},1000)
		redirect(url);
	}
}

function closeAd () {
	if (window.mraid)
            mraid.close()
        else
            document.location = 'exit:'
}

// Call to send impression when you feel it's the right time //
function sendImpression () {
	log('sendImpression')
	if (impressionMade == 0) {
		impressionMade += 1;
		if (ptrackers != '') {
			document.getElementById('ptrack').innerHTML += ptrackers;
		}
		try {
			call_client(creative_id);
		} catch (e) {}
	};		
}

/*
// Enable this function when the tag redirect via wwindow.open //

window.fOpen = window.open;
window.open = function () {
	var redirUrl = 'link:'+ clickUrlRedirect + encodeURIComponent(encodeURIComponent(arguments[0]).replace(/%20/g,'+'));
	console.log(redirUrl);
	redir(redirUrl);
}
*/

function log() {
	console.log.apply(console, arguments);
	if(DEBUG_MODE) {
		var logMsgs = [];
		for (i in arguments) {
			logMsgs[i] = arguments[i].toString();
		}
		document.getElementById('debug_area').innerHTML += ' <-- ' + logMsgs.join(', ') + ' --> <br>';
	}
}

function setUpTag (tag) {
	var adFrame = document.getElementById('image');
	adFrame.src = tag.src;
	
	document.getElementById('click_area').addEventListener('click', function (e) {
		clickThru(tag.href);
	});
	
	if (typeof isViewabilityMoat != 'undefined' && parseInt(isViewabilityMoat) == 1) {
		addMOATtracking();
	}
}

var deviceDimension = (function (url) {
	var dimension = {
		width: Number(params.width),
		height: Number(params.height),
	};

	if(isNaN(dimension.width) || isNaN(dimension.height)) {
		dimension.width = window.innerWidth;
		dimension.height = window.innerHeight;
		dimension.isLandscape = (dimension.width > dimension.height);
		return dimension;
	} else {
		dimension.isLandscape = (dimension.width > dimension.height);
		return dimension;
	}
})();

(function setUpAd() {
	log("Try detectt script");
	log('deviceDimension: ' + deviceDimension.width + ' ' + deviceDimension.height);
	if (deviceDimension.width > 0 && deviceDimension.width != deviceDimension.height) {

		var isLandscape = true;

		if (deviceDimension.width > deviceDimension.height) { /* landscape */
			log('landscape, width: ' + deviceDimension.width + ' height: ' + deviceDimension.height);
			isLandscape = true;
			var ratioDiffDefault = 1.33 - (deviceDimension.width / deviceDimension.height) > 0 ? 1.33 - (deviceDimension.width / deviceDimension.height) : (deviceDimension.width / deviceDimension.height) - 1.33,
			ratioDiffAndroid = 1.77 - (deviceDimension.width / deviceDimension.height) > 0 ? 1.77 - (deviceDimension.width / deviceDimension.height) : (deviceDimension.width / deviceDimension.height) - 1.77;

			log('ratio: ' + (deviceDimension.width / deviceDimension.height) + ' ratioDiffDefault 1.33 : ' + ratioDiffDefault + ' ratioDiffAndroid 1.77 : ' + ratioDiffAndroid);

			if (ratioDiffDefault > ratioDiffAndroid) { /* use android */
				log('landscape android');
				setUpTag(images.landscape.android);					
			} else { /* use default */
				log('landscape default');
				setUpTag(images.landscape.default);
			}
		} else { /* portrait */
			isLandscape = false;
			log('portrait, width: ' + deviceDimension.width + ' height: ' + deviceDimension.height);
			var ratioDiffDefault = 1.33 - (deviceDimension.height / deviceDimension.width) > 0 ? 1.33 - (deviceDimension.height / deviceDimension.width) : (deviceDimension.height / deviceDimension.width) - 1.33,
			ratioDiffAndroid = 1.77 - (deviceDimension.height / deviceDimension.width) > 0 ? 1.77 - (deviceDimension.height / deviceDimension.width) : (deviceDimension.height / deviceDimension.width) - 1.77;

			log('ratio: ' + (deviceDimension.width / deviceDimension.height) + ' ratioDiffDefault 1.33 : ' + ratioDiffDefault + ' ratioDiffAndroid 1.77 : ' + ratioDiffAndroid);

			if (ratioDiffDefault > ratioDiffAndroid) { /* use android */
				log('portrait android');
				setUpTag(images.portrait.android);
			} else { /* use default */
				log('portrait default');
				setUpTag(images.portrait.default);
			}
		}

		var findClick = setInterval(function () {
			var imgBan = document.getElementById('image');
			if(imgBan != null) {
				clearInterval(findClick);
				
				if(imgBan.complete) {
					document.getElementById("exitArea").setAttribute('style', 'visibility: visible');
					document.getElementById("advertisement").setAttribute('style', 'opacity: 1');
					document.getElementById("loader-wrapper").setAttribute('style', 'display: none');
				} else {
					imgBan.setAttribute('style', 'opacity: 0');

					imgBan.addEventListener('load', function () {
						imgBan.setAttribute('style', 'opacity: 1');
						document.getElementById("exitArea").setAttribute('style', 'visibility: visible');
						document.getElementById('advertisement').setAttribute('style', 'opacity: 1');
						document.getElementById('loader-wrapper').setAttribute('style', 'display: none');
					});
				}
			}
		}, 100);

		var timeLapsed = 0;
		var errorClose = setInterval(function() {
			timeLapsed += 1000;
			log(timeLapsed);
			if (timeLapsed >= 5000) {
				document.getElementById('exitArea').setAttribute('style', 'visibility: visible');
				clearInterval(errorClose);
			}
		}, 1000);
	}
})();

function addMOATtracking() {
	var MOATnoscript = document.createElement('noscript');
	MOATnoscript.setAttribute('class', 'MOAT-gameloftinappsdk455988337278?moatClientLevel1={[campaign_id]}&moatClientLevel2={[creative_id]}&moatClientLevel3={[location_id]}&moatClientLevel4=_LINEITEM_&moatClientSlicer1={[game_fullname]}&moatClientSlicer2=_PLACEMENT_');
	document.body.appendChild(MOATnoscript);

	var MOATscript = document.createElement('script');
	MOATscript.type = 'text/javascript';
	MOATscript.src = 'https://z.moatads.com/gameloftinappsdk455988337278/moatad.js#moatClientLevel1={[campaign_id]}&moatClientLevel2={[creative_id]}&moatClientLevel3={[location_id]}&moatClientLevel4=_LINEITEM_&moatClientSlicer1={[game_fullname]}&moatClientSlicer2=_PLACEMENT_';
	document.body.appendChild(MOATscript);
}
</script>
<script src="https://cdn.doubleverify.com/dvtp_src.js?ctx=1769548&cmp=796013&sid=16408&plc=22076541&num=&adid=&advid=1769549&adsrv=115&region=30&btreg=&btadsrv=&crt=&crtname=&chnl=&unit=&pid=&uid=&tagtype=&app=&sup=&DVP_EXID=&DVP_CDID=&DVP_DMGRV=&DVP_LAT=&DVP_LONG=&dvtagver=6.1.src" type="text/javascript"></script>
</body>
</html>